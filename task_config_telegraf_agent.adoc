---
sidebar: sidebar 
permalink: task_config_telegraf_agent.html 
keywords: telegraf, installation, install, agent, telegraf agent 
summary: 支援Telegraf作為收集整合資料的代理程式、可在Windows、Linux、MacOS和Kubernetes上設定。Cloud Insights 
---
= 設定代理程式以收集資料（Linux/Linux/Mac）
:allow-uri-read: 


[role="lead"]
使用Cloud Insights link:https://docs.influxdata.com/telegraf["Telegraf"] 做為收集整合資料的代理程式。Telegraf是外掛程式導向的伺服器代理程式、可用來收集及報告度量、事件及記錄。輸入外掛程式可透過直接存取系統/作業系統、呼叫協力廠商API或聆聽已設定的串流（例如 卡夫卡、塔斯D等）。輸出外掛程式可用來將收集到的度量、事件和記錄從代理程式傳送至Cloud Insights

目前的Telegraf版本Cloud Insights 是* 1.22.3*。


NOTE: 為確保稽核與資料報告的準確性、強烈建議您使用*網路時間傳輸協定（NTP）*或*簡易網路時間傳輸協定（SNTP）*來同步代理機器上的時間。


NOTE: 如果您想在安裝代理程式之前驗證安裝檔案、請參閱以下的一節  Checksums。



== 安裝代理程式

如果您正在安裝服務資料收集器、但尚未設定代理程式、系統會提示您先安裝適當作業系統的代理程式。本主題提供在下列作業系統上安裝Telegraf代理程式的說明：

* 
*  and CentOS
*  and Debian
* 
* 


若要安裝代理程式、無論您使用的平台為何、都必須先執行下列動作：

. 登入您要用於代理程式的主機。
. 登入Cloud Insights 您的支援網站、前往*管理>資料收集器*。
. 按一下「*+資料收集器*」、然後選擇要安裝的資料收集器。


. 為主機選擇適當的平台（Windows、Linux、MacOS等）
. 請針對每個平台執行其餘步驟。



NOTE: 在主機上安裝代理程式之後、您就不需要在該主機上重新安裝代理程式。


TIP: 在伺服器/ VM上安裝代理程式之後Cloud Insights 、除了從您設定的任何資料收集器收集資料、還會從該系統收集度量資料。這些指標的收集方式如下 link:task_config_telegraf_node.html["「節點」度量"]。


NOTE: 如果您使用的是Proxy、請先閱讀平台的Proxy指示、再安裝Telegraf代理程式。



=== Windows



==== 先決條件：

* 必須安裝PowerShell
* 如果您使用的是Proxy、則必須遵循*設定Proxy支援for Windows *一節中的指示。




==== 設定適用於Windows的Proxy支援


NOTE: 如果您的環境使用Proxy、請先閱讀本節再安裝。


NOTE: 以下步驟概述設定_https_proxy/https_proxy_環境變數所需的動作。在某些Proxy環境中、使用者可能也需要設定_no_proxyEnvironments _變數。

對於位於Proxy後的系統、請執行下列步驟、設定安裝Telegraf代理程式之前*的_https_proxy_和/或_https_proxy_環境變數：

 [System.Environment]::SetEnvironmentVariable(“https_proxy”, “<proxy_server>:<proxy_port>”, [System.EnvironmentVariableTarget]::Machine)


==== 安裝代理程式

image:AgentInstallWindows.png["Windows代理程式安裝"]

.在Windows上安裝代理程式的步驟：
. 選擇代理程式存取金鑰。
. 從代理程式安裝對話方塊複製命令區塊。您可以按一下剪貼簿圖示、將命令快速複製到剪貼簿。
. 開啟PowerShell視窗
. 將命令貼到PowerShell視窗中、然後按Enter鍵。
. 命令會下載適當的代理程式安裝程式、安裝並設定預設組態。完成後、它會重新啟動代理程式服務。此命令具有唯一的金鑰、有效時間為24小時。
. 單擊*完成*或*繼續*


安裝代理程式之後、您可以使用下列命令來啟動/停止服務：

....
Start-Service telegraf
Stop-Service telegraf
....


==== 解除安裝代理程式

若要在Windows上解除安裝代理程式、請在PowerShell視窗中執行下列動作：

. 停止並刪除Telegraf服務：
+
....
Stop-Service telegraf
sc.exe delete telegraf
....
. 從信任來源移除憑證：
+
....
cd Cert:\CurrentUser\Root
rm E5FB7B68C08B1CA902708584C274F8EFC7BE8ABC
....
. 刪除_C:\Program Files\Telewraf_資料夾、以移除二進位檔、記錄檔和組態檔
. 從登錄中移除_system\CurrentControlSet\Services\EventLog\Application\Telewraf_機碼




==== 升級代理程式

若要升級Telewraf代理程式、請執行下列步驟：

. 停止並刪除Telewraf服務：
+
....
Stop-Service telegraf
sc.exe delete telegraf
....
. 從登錄中刪除_system\CurrentControlSet\Services\EventLog\Application\Telewraf_機碼
. 刪除_C:\Program Files\Telewraf\Telewraf.conf
. 刪除_C:\Program Files\Telewraf\Telewraf_exe_
. link:#windows["安裝新代理程式"]。




=== RHEL與CentOS



==== 先決條件：

* 下列命令必須可用：curl、Sudo、ping、shav256sum、openssl、 和dmidecode
* 如果您使用Proxy、則必須遵循*設定RHEL/CentOS* Proxy支援一節中的指示。




==== 設定RHEL/CentOS的Proxy支援


NOTE: 如果您的環境使用Proxy、請先閱讀本節再安裝。


NOTE: 以下步驟概述設定_https_proxy/https_proxy_環境變數所需的動作。在某些Proxy環境中、使用者可能也需要設定_no_proxyEnvironments _變數。

對於位於Proxy之後的系統、請執行下列步驟*先前*、以安裝Telegraf代理程式：

. 為目前使用者設定_https_proxy_和/或_https_proxy_環境變數：
+
 export https_proxy=<proxy_server>:<proxy_port>
. 建立/etc/default/Telegraf_、並插入_https_proxy_和/或_https_proxy_變數的定義：
+
 https_proxy=<proxy_server>:<proxy_port>




==== 安裝代理程式

image:Agent_Requirements_Rhel.png["安裝RHEL/CentOS代理程式"]

.在RHEL/CentOS上安裝代理程式的步驟：
. 選擇代理程式存取金鑰。
. 從代理程式安裝對話方塊複製命令區塊。您可以按一下剪貼簿圖示、將命令快速複製到剪貼簿。
. 開啟Bash視窗
. 將命令貼到Bash視窗中、然後按Enter鍵。
. 命令會下載適當的代理程式安裝程式、安裝並設定預設組態。完成後、它會重新啟動代理程式服務。此命令具有唯一的金鑰、有效時間為24小時。
. 單擊*完成*或*繼續*


安裝代理程式之後、您可以使用下列命令來啟動/停止服務：

如果您的作業系統使用systemd（CentOS 7+和RHEL 7+）：

....
sudo systemctl start telegraf
sudo systemctl stop telegraf
....
如果您的作業系統未使用systemd（CentOS 7+和RHEL 7+）：

....
sudo service telegraf start
sudo service telegraf stop
....


==== 解除安裝代理程式

若要在RHEL/CentOS上解除安裝代理程式、請在Bash終端機中執行下列動作：

. 停止Telegraf服務：
+
....
systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. 移除Telegraf代理程式：
+
 yum remove telegraf
. 移除可能留下的任何組態或記錄檔：
+
....
rm -rf /etc/telegraf*
rm -rf /var/log/telegraf*
....




==== 升級代理程式

若要升級Telewraf代理程式、請執行下列步驟：

. 停止Telewraf服務：
+
....
systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. 移除先前的Telewraf代理程式：
+
 yum remove telegraf
. link:#rhel-and-centos["安裝新代理程式"]。




=== Ubuntu與DEBIAN



==== 先決條件：

* 下列命令必須可用：curl、Sudo、ping、shav256sum、openssl、 和dmidecode
* 如果您使用的是代理服務器，則必須按照*配置Ubuntu / DEBIAN*代理支持一節中的說明操作。




==== 設定Ubuntu / Debian的Proxy支援


NOTE: 如果您的環境使用Proxy、請先閱讀本節再安裝。


NOTE: 以下步驟概述設定_https_proxy/https_proxy_環境變數所需的動作。在某些Proxy環境中、使用者可能也需要設定_no_proxyEnvironments _變數。

對於位於Proxy之後的系統、請執行下列步驟*先前*、以安裝Telegraf代理程式：

. 為目前使用者設定_https_proxy_和/或_https_proxy_環境變數：
+
 export https_proxy=<proxy_server>:<proxy_port>
. 建立/etc/default/Telegraf、並插入_https_proxy_和/或_https_proxy_變數的定義：
+
 https_proxy=<proxy_server>:<proxy_port>




==== 安裝代理程式

image:Agent_Requirements_Ubuntu.png["安裝Ubuntu / Debian代理程式"]

.在Debian或Ubuntu上安裝代理程式的步驟：
. 選擇代理程式存取金鑰。
. 從代理程式安裝對話方塊複製命令區塊。您可以按一下剪貼簿圖示、將命令快速複製到剪貼簿。
. 開啟Bash視窗
. 將命令貼到Bash視窗中、然後按Enter鍵。
. 命令會下載適當的代理程式安裝程式、安裝並設定預設組態。完成後、它會重新啟動代理程式服務。此命令具有唯一的金鑰、有效時間為24小時。
. 單擊*完成*或*繼續*


安裝代理程式之後、您可以使用下列命令來啟動/停止服務：

如果您的作業系統使用systemd：

....
sudo systemctl start telegraf
sudo systemctl stop telegraf
....
如果您的作業系統未使用systemd：

....
sudo service telegraf start
sudo service telegraf stop
....


==== 解除安裝代理程式

若要在Ubuntu / Debian上解除安裝代理程式、請在Bash終端機中執行下列作業：

. 停止Telegraf服務：
+
....
systemctl stop telegraf (If your operating system is using systemd)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. 移除Telegraf代理程式：
+
 dpkg -r telegraf
. 移除可能留下的任何組態或記錄檔：
+
....
rm -rf /etc/telegraf*
rm -rf /var/log/telegraf*
....




==== 升級代理程式

若要升級Telewraf代理程式、請執行下列步驟：

. 停止Telewraf服務：
+
....
systemctl stop telegraf (If your operating system is using systemd)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. 移除先前的Telewraf代理程式：
+
 dpkg -r telegraf
. link:#ubuntu-and-debian["安裝新代理程式"]。




=== MacOS



==== 先決條件：

* 下列命令必須可用：Curl、Sudo、openssl和shasum
* 如果您使用的是Proxy、則必須遵循「*設定MacOS的Proxy支援」一節中的指示。




==== 設定適用於MacOS的Proxy支援


NOTE: 如果您的環境使用Proxy、請先閱讀本節再安裝。


NOTE: 以下步驟概述設定_https_proxy/https_proxy_環境變數所需的動作。在某些Proxy環境中、使用者可能也需要設定_no_proxyEnvironments _變數。

對於位於Proxy後的系統、請執行下列步驟、為目前使用者*安裝Telegraf代理程式之前*設定_https_proxy_和/或_https_proxy_環境變數：

 export https_proxy=<proxy_server>:<proxy_port>
*安裝Telegraf代理程式之後、請在_/Applications/Telegraf.app/Contents / telegraf.plist_:中新增並設定適當的_https_proxy_和/或_https_proxy_變數

....
…
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
   <key>EnvironmentVariables</key>
   <dict>
          <key>https_proxy</key>
          <string><proxy_server>:<proxy_port></string>
   </dict>
   <key>Program</key>
   <string>/Applications/telegraf.app/Contents/MacOS/telegraf</string>
   <key>Label</key>
   <string>telegraf</string>
   <key>ProgramArguments</key>
   <array>
     <string>/Applications/telegraf.app/Contents/MacOS/telegraf</string>
     <string>--config</string>
     <string>/usr/local/etc/telegraf.conf</string>
     <string>--config-directory</string>
     <string>/usr/local/etc/telegraf.d</string>
   </array>
   <key>RunAtLoad</key>
   <true/>
</dict>
</plist>
…
....
然後、在載入上述變更後重新啟動Telegraf：

....
sudo launchctl stop telegraf
sudo launchctl unload -w /Library/LaunchDaemons/telegraf.plist
sudo launchctl load -w /Library/LaunchDaemons/telegraf.plist
sudo launchctl start telegraf
....


==== 安裝代理程式

image:Agent_Requirements_Macos.png["安裝MacOS代理程式"]

.在MacOS上安裝代理程式的步驟：
. 選擇代理程式存取金鑰。
. 從代理程式安裝對話方塊複製命令區塊。您可以按一下剪貼簿圖示、將命令快速複製到剪貼簿。
. 開啟Bash視窗
. 將命令貼到Bash視窗中、然後按Enter鍵。
. 命令會下載適當的代理程式安裝程式、安裝並設定預設組態。完成後、它會重新啟動代理程式服務。此命令具有唯一的金鑰、有效時間為24小時。
. 如果您先前使用homebw安裝Telegraf代理程式、系統會提示您解除安裝。一旦解除安裝先前安裝的Telegraf代理程式、請重新執行上述步驟5中的命令。
. 單擊*完成*或*繼續*


安裝代理程式之後、您可以使用下列命令來啟動/停止服務：

....
sudo launchctl start telegraf
sudo launchctl stop telegraf
....


==== 解除安裝代理程式

若要在MacOS上解除安裝代理程式、請在Bash終端機中執行下列步驟：

. 停止Telegraf服務：
+
 sudo launchctl stop telegraf
. 解除安裝Telewraf代理程式：
+
....
cp /Applications/telegraf.app/scripts/uninstall /tmp
sudo /tmp/uninstall
....
. 移除可能留下的任何組態或記錄檔：
+
....
rm -rf /usr/local/etc/telegraf*
rm -rf /usr/local/var/log/telegraf.*
....




==== 升級代理程式

若要升級Telewraf代理程式、請執行下列步驟：

. 停止Telewraf服務：
+
 sudo launchctl stop telegraf
. 解除安裝先前的Telewraf代理程式：
+
....
cp /Applications/telegraf.app/scripts/uninstall /tmp
sudo /tmp/uninstall
....
. link:#macos["安裝新代理程式"]。


｛Empty｝｛Empty｝｛Empty｝｛Empty｝｛Empty｝ ｛空白｝



== Kubernetes

NetApp Kubernetes監控營運者（NKMO）是安裝Kubernetes for Cloud Insights Sesi Insights的首選方法、可更靈活地設定監控作業、減少步驟、並有更多機會監控K8s叢集中執行的其他軟體。

麻煩了 link:task_config_telegraf_agent_k8s.html["*到這裡*"] 以取得NetApp Kubernetes監控操作員的資訊與安裝指示。

｛Empty｝｛Empty｝｛Empty｝｛Empty｝｛Empty｝ ｛空白｝



== 驗證Checksum

雖然無法執行完整性檢查、Cloud Insights 但有些使用者可能想在安裝或套用下載的成品之前、先執行自己的驗證。若要執行純下載作業（而非預設的下載與安裝）、這些使用者可以編輯從UI取得的代理程式安裝命令、並移除後續的「install」選項。

請遵循下列步驟：

. 依照指示複製代理程式安裝程式程式片段。
. 不要將程式碼片段貼到命令視窗中、而是貼到文字編輯器中。
. 從命令中刪除後端"--install"（Linux/Mac）或"-install"（Windows）。
. 從文字編輯器複製整個命令。
. 現在請將其貼到命令視窗（工作目錄）中、然後執行。


非Windows（這些範例適用於Kubernetes；實際的指令碼名稱可能有所不同）：

* 下載並安裝（預設）：
+
 installerName=cloudinsights-kubernetes.sh … && sudo -E -H ./$installerName --download –-install
* 僅限下載：
+
 installerName=cloudinsights-kubernetes.sh … && sudo -E -H ./$installerName --download


Windows：

* 下載並安裝（預設）：
+
 !$($installerName=".\cloudinsights-windows.ps1") … -and $(&$installerName -download -install)
* 僅限下載：
+
 !$($installerName=".\cloudinsights-windows.ps1") … -and $(&$installerName -download)


純下載命令會將Cloud Insights 所有必要的成品從功能性資訊下載到工作目錄。這些成品包括但不限於：

* 安裝指令碼
* 環境檔案
* Y反 洗錢檔案
* 簽署的Checksum檔案（結尾為sh256.signed或sh256.ps1）
* 用於簽名驗證的一個PES檔案（NetApp_CERT.pem）


安裝指令碼、環境檔案及Yaml檔案均可使用目視檢查進行驗證。

您可以確認其指紋為下列項目、以驗證該PEM檔案：

 E5:FB:7B:68:C0:8B:1C:A9:02:70:85:84:C2:74:F8:EF:C7:BE:8A:BC
更具體地說、

* 非Windows：
+
 openssl x509 -fingerprint -sha1 -noout -inform pem -in netapp_cert.pem
* Windows：
+
 Import-Certificate -Filepath .\netapp_cert.pem -CertStoreLocation Cert:\CurrentUser\Root


簽署的Checksum檔案可以使用PEM檔案進行驗證：

* 非Windows：


 openssl smime -verify -in telegraf*.sha256.signed -CAfile netapp_cert.pem -purpose any
* Windows（透過上述匯入憑證安裝憑證之後）：


 Get-AuthenticodeSignature -FilePath .\telegraf.zip.sha256.ps1 $result = Get-AuthenticodeSignature -FilePath .\telegraf.zip.sha256.ps1 $signer = $result.SignerCertificate Add-Type -Assembly System.Security [Security.Cryptography.x509Certificates.X509Certificate2UI]::DisplayCertificate($signer)
一旦所有成品都已通過驗證、即可執行下列步驟來啟動代理程式安裝：

非Windows：

 sudo -E -H ./<installation_script_name> --install
Windows：

 .\cloudinsights-windows.ps1 -install


== 代理程式安裝疑難排解

如果您在設定代理程式時遇到問題、請嘗試下列事項：

[cols="2*"]
|===
| 問題： | 試用： 


| 我已經用Cloud Insights 了這個功能來安裝代理程式 | 如果您已在主機/ VM上安裝代理程式、則不需要重新安裝代理程式。在這種情況下、只要在「代理程式安裝」畫面中選擇適當的平台和金鑰、然後按一下*繼續*或*完成*即可。 


| 我已經安裝了代理程式、但沒有使用Cloud Insights 這個安裝程式 | 移除先前的代理程式並執行Cloud Insights 安裝程序、以確保預設的組態檔設定正確無誤。完成後、按一下*繼續*或*完成*。 
|===
如需其他資訊、請參閱 link:concept_requesting_support.html["支援"] 頁面或中的 link:https://docs.netapp.com/us-en/cloudinsights/CloudInsightsDataCollectorSupportMatrix.pdf["資料收集器支援對照表"]。
